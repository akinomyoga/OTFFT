<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="OTFFT のシングルスレッドベンチマーク">
<meta name="keywords" content="OTFFT,シングルスレッド,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="otfft1.html">

<!--
<script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
-->
<script async src="ga.js"></script>

<title>OTFFT のシングルスレッドベンチマーク</title>
</head>
<body>
<a href="otfft1.html">OTFFT -- FFTW より速い FFT ライブラリ</a>
<hr>

<h1>OTFFT のシングルスレッドベンチマーク</h1>
<p>
　OTFFT はデフォルトでは OpenMP によるマルチスレッドで動作します。しかし、
中にはマルチスレッドの実装は、自前の仕組みを使いたい人もいるかもしれません。
そこで、シングルスレッドのバージョンも用意しました。
</p>
<p>
　そんなわけで、シングルスレッドのベンチマークもしてみました。
条件は以下のようになります。
</p>
<table style="padding-left:1em">
    <tr>
        <td>Machine:</td><td>MacBook Pro 15 inch Late 2016 (Core i7 2.6GHz)</td>
    </tr>
    <tr>
        <td>OS:</td><td>macOS Mojave</td>
    </tr>
    <tr>
        <td>Compiler:</td><td>Clang 8.0</td>
    </tr>
    <tr>
        <td>cores/threads:</td><td>4 cores/1 thread</td>
    </tr>
    <tr>
        <td>FFTW Version:</td><td>3.3.8</td>
    </tr>
    <tr>
        <td>FFTW Mode:</td><td>FFTW_MEASURE (AVX2 enabled)</td>
    </tr>
    <tr>
        <td>浮動小数点数の精度:</td><td>倍精度</td>
    </tr>
</table>
<p>
ベンチマーク結果は以下のようになります。
</p>
<!--
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.03|       0.02( 61%)|       0.02( 54%)|       0.01( 31%)| -
2^( 2)|       0.03|       0.02( 70%)|       0.03(103%)|       0.01( 35%)| -
2^( 3)|       0.05|       0.05(113%)|       0.06(134%)|       0.02( 49%)|-28
2^( 4)|       0.08|       0.11(131%)|       0.14(170%)|       0.05( 57%)|-27
2^( 5)|       0.15|       0.35(232%)|       0.27(182%)|       0.11( 74%)|-27
2^( 6)|       0.29|       0.80(274%)|       0.67(228%)|       0.21( 73%)|-26
2^( 7)|       0.60|       1.82(306%)|       1.37(230%)|       0.52( 88%)|-25
2^( 8)|       1.23|       4.38(355%)|       3.27(265%)|       1.12( 91%)|-25
2^( 9)|       3.07|       9.02(294%)|       6.85(223%)|       2.55( 83%)|-24
2^(10)|       7.45|      20.02(269%)|      15.95(214%)|       6.60( 89%)|-22
2^(11)|      17.36|      44.79(258%)|      35.18(203%)|      15.46( 89%)|-22
2^(12)|      49.07|     100.22(204%)|      96.28(196%)|      45.39( 92%)|-22
2^(13)|     108.84|     221.65(204%)|     217.02(199%)|     100.33( 92%)|-21
2^(14)|     261.97|     475.67(182%)|     501.34(191%)|     231.03( 88%)|-20
2^(15)|     566.57|    1055.42(186%)|    1213.14(214%)|     505.46( 89%)|-19
2^(16)|    1227.13|    2259.72(184%)|    2718.39(222%)|    1247.99(102%)|-19
2^(17)|    2870.26|    4463.65(156%)|    5927.26(207%)|    2706.74( 94%)|-18
2^(18)|    6858.93|   10769.50(157%)|   13592.80(198%)|    6312.14( 92%)|-18
2^(19)|   23232.44|   22286.98( 96%)|   38805.69(167%)|   15932.69( 69%)|-17
2^(20)|   47349.47|   50978.10(108%)|   96383.92(204%)|   32182.71( 68%)|-16
2^(21)|  129152.30|   96490.15( 75%)|  239259.00(185%)|   66334.24( 51%)|-16
2^(22)|  280796.95|  221983.07( 79%)|  557601.19(199%)|  188107.98( 67%)|-15
2^(23)|  624020.42|  466706.57( 75%)| 1640427.10(263%)|  491595.83( 79%)|-15
2^(24)| 1249313.25| 1102021.69( 88%)| 4296091.87(344%)| 1099916.47( 88%)|-14
------+-----------+-----------------+-----------------+-----------------+---
 cost |  388297.63|  466021.24(120%)|  852095.71(219%)|  292417.90( 75%)|
------+-----------+-----------------+-----------------+-----------------+---
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.02|       0.01( 61%)|       0.01( 62%)|       0.01( 40%)| -
2^( 2)|       0.03|       0.02( 77%)|       0.04(138%)|       0.01( 44%)| -
2^( 3)|       0.03|       0.04(104%)|       0.06(172%)|       0.02( 59%)|-28
2^( 4)|       0.06|       0.07(110%)|       0.14(226%)|       0.03( 56%)|-27
2^( 5)|       0.12|       0.23(196%)|       0.26(219%)|       0.07( 62%)|-27
2^( 6)|       0.21|       0.53(251%)|       0.65(304%)|       0.16( 74%)|-26
2^( 7)|       0.43|       1.27(294%)|       1.31(303%)|       0.38( 87%)|-25
2^( 8)|       0.98|       2.79(286%)|       3.19(327%)|       0.77( 79%)|-24
2^( 9)|       2.30|       6.44(280%)|       6.57(286%)|       1.72( 75%)|-23
2^(10)|       4.88|      14.16(290%)|      15.60(320%)|       4.09( 84%)|-23
2^(11)|      11.85|      32.24(272%)|      34.13(288%)|      10.55( 89%)|-22
2^(12)|      33.57|      70.73(211%)|      97.42(290%)|      27.51( 82%)|-21
2^(13)|      71.08|     157.32(221%)|     221.52(312%)|      59.28( 83%)|-21
2^(14)|     170.16|     334.43(197%)|     514.54(302%)|     141.21( 83%)|-20
2^(15)|     392.69|     759.38(193%)|    1153.80(294%)|     306.29( 78%)|-19
2^(16)|     883.71|    1623.06(184%)|    2628.77(297%)|     814.42( 92%)|-19
2^(17)|    1997.99|    3700.64(185%)|    5652.23(283%)|    2064.05(103%)|-18
2^(18)|    7827.45|    8174.35(104%)|   15145.78(193%)|    7158.03( 91%)|-17
2^(19)|   19442.64|   20330.57(105%)|   57260.52(295%)|   15052.18( 77%)|-16
2^(20)|   41872.30|   49631.28(119%)|  148610.36(355%)|   33397.25( 80%)|-16
2^(21)|   81978.36|  105268.42(128%)|  342922.04(418%)|   76977.77( 94%)|-15
2^(22)|  176019.43|  225546.05(128%)|  739391.50(420%)|  158527.52( 90%)|-14
2^(23)|  365432.93|  466596.07(128%)| 1695291.10(464%)|  320784.63( 88%)|-14
2^(24)|  787760.14|  993744.64(126%)| 3784320.71(480%)|  678996.87( 86%)|-13
------+-----------+-----------------+-----------------+-----------------+---
 cost |  275667.08|  390926.75(142%)|  954444.92(346%)|  230840.24( 84%)|
------+-----------+-----------------+-----------------+-----------------+---
-->
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.02|       0.01( 61%)|       0.01( 53%)|       0.01( 42%)| -
2^( 2)|       0.03|       0.02( 77%)|       0.03(133%)|       0.01( 45%)| -
2^( 3)|       0.03|       0.04(104%)|       0.06(171%)|       0.02( 59%)|-28
2^( 4)|       0.06|       0.07(116%)|       0.14(238%)|       0.04( 68%)|-27
2^( 5)|       0.11|       0.23(207%)|       0.25(230%)|       0.07( 65%)|-26
2^( 6)|       0.22|       0.53(245%)|       0.64(299%)|       0.15( 68%)|-26
2^( 7)|       0.45|       1.27(281%)|       1.30(288%)|       0.38( 84%)|-25
2^( 8)|       0.96|       2.79(292%)|       3.42(358%)|       0.76( 79%)|-24
2^( 9)|       2.28|       6.46(283%)|       6.45(283%)|       1.72( 75%)|-24
2^(10)|       4.90|      14.19(290%)|      15.55(318%)|       4.04( 83%)|-23
2^(11)|      12.79|      32.50(254%)|      34.17(267%)|      10.44( 82%)|-22
2^(12)|      34.72|      70.26(202%)|      95.78(276%)|      27.24( 78%)|-21
2^(13)|      70.81|     157.19(222%)|     217.72(307%)|      60.53( 85%)|-21
2^(14)|     172.76|     338.71(196%)|     507.11(294%)|     142.90( 83%)|-20
2^(15)|     404.53|     768.26(190%)|    1151.20(285%)|     302.49( 75%)|-19
2^(16)|     829.63|    1637.90(197%)|    2647.29(319%)|     798.94( 96%)|-19
2^(17)|    1986.72|    3733.97(188%)|    5684.38(286%)|    1776.99( 89%)|-18
2^(18)|    7765.57|    8208.45(106%)|   17001.13(219%)|    6231.60( 80%)|-17
2^(19)|   19391.43|   22212.53(115%)|   58043.84(299%)|   15343.95( 79%)|-16
2^(20)|   41074.85|   52242.91(127%)|  168200.99(409%)|   34498.74( 84%)|-16
2^(21)|   81829.61|  109663.70(134%)|  383436.57(469%)|   73210.23( 89%)|-15
2^(22)|  179010.29|  228701.05(128%)|  845191.32(472%)|  158326.91( 88%)|-15
2^(23)|  373002.22|  469632.27(126%)| 1813317.81(486%)|  334035.20( 90%)|-14
2^(24)|  821348.29| 1042829.71(127%)| 3892317.31(474%)|  664336.87( 81%)|-14
------+-----------+-----------------+-----------------+-----------------+---
 cost |  277291.85|  400070.07(144%)| 1015388.16(366%)|  227117.65( 82%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　このベンチマークはノートパソコンで行いました。
その方が Amazon EC2 m5.2xlarge インスタンスでやるより
OTFFT の成績が良いからです。
どうやら、シングルスレッドで FFT を行う場合は、
1コアをフル回転させてもノートパソコンでも熱設計的に余裕があるらしく、
OTFFT が速くなるようです。
</p>

<hr>
<a href="otfft1.html">OTFFT -- FFTW より速い FFT ライブラリ</a>
</body>
</html>
