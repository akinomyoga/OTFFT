<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="description" content="OTFFT のシングルスレッドベンチマーク">
<meta name="keywords" content="OTFFT,シングルスレッド,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="node4.html">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript" src="ga.js"></script>

<title>OTFFT のシングルスレッドベンチマーク</title>
</head>
<body>
<h1>OTFFT のシングルスレッドベンチマーク</h1>
<p>
　OTFFT はデフォルトでは OpenMP によるマルチスレッドで動作します。しかし、
中にはマルチスレッドの実装は、自前の仕組みを使いたい人もいるかもしれません。
そこで、シングルスレッドで動作するモードも用意しました。
OTFFT は DO_SINGLE_THREAD マクロを定義してコンパイルすると、
シングルスレッドモードになります。
</p>
<p>
　そんなわけで、シングルスレッドのベンチマークもしてみました。
実行環境は MacBook Pro 15 inch Late 2013(Haswell Core i7 2GHz) 上の
OS X El Capitan/GCC 5.3 です。
比較した FFTW3 はバージョン 3.3.4 の <code>FFTW_MEASURE</code> です。
浮動小数点数の精度は倍精度です。
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.03|       0.02( 65%)|       0.02( 67%)|       0.01( 49%)| -
2^( 2)|       0.03|       0.03( 84%)|       0.04(142%)|       0.02( 51%)| -
2^( 3)|       0.04|       0.06(138%)|       0.07(178%)|       0.03( 62%)|-28
2^( 4)|       0.08|       0.12(143%)|       0.16(199%)|       0.05( 65%)|-29
2^( 5)|       0.15|       0.37(246%)|       0.33(221%)|       0.12( 79%)|-28
2^( 6)|       0.30|       0.83(276%)|       0.77(254%)|       0.23( 77%)|-28
2^( 7)|       0.65|       1.78(274%)|       1.62(249%)|       0.54( 83%)|-28
2^( 8)|       1.46|       3.83(263%)|       3.73(256%)|       1.08( 74%)|-28
2^( 9)|       3.27|       8.64(264%)|       7.94(243%)|       2.45( 75%)|-28
2^(10)|       7.13|      18.36(258%)|      18.00(253%)|       6.38( 90%)|-28
2^(11)|      17.25|      41.39(240%)|      40.58(235%)|      15.94( 92%)|-27
2^(12)|      43.16|      90.98(211%)|     103.36(239%)|      42.48( 98%)|-27
2^(13)|     107.46|     201.03(187%)|     233.93(218%)|      98.96( 92%)|-27
2^(14)|     258.17|     432.99(168%)|     535.96(208%)|     227.57( 88%)|-27
2^(15)|     561.78|     968.50(172%)|    1255.29(223%)|     489.01( 87%)|-27
2^(16)|    1182.05|    1976.42(167%)|    2766.04(234%)|    1222.91(103%)|-27
2^(17)|    2907.28|    4125.93(142%)|    5960.73(205%)|    2585.71( 89%)|-27
2^(18)|    6922.15|    8838.16(128%)|   15067.39(218%)|    6201.44( 90%)|-27
2^(19)|   24989.56|   19229.84( 77%)|   40022.24(160%)|   17044.08( 68%)|-27
2^(20)|   46681.51|   42110.82( 90%)|   97774.36(209%)|   33937.72( 73%)|-27
2^(21)|  117283.24|   87297.77( 74%)|  235417.67(201%)|   68279.98( 58%)|-27
2^(22)|  252490.26|  186986.67( 74%)|  532805.12(211%)|  165983.57( 66%)|-27
2^(23)|  579738.86|  420552.34( 73%)| 1573680.32(271%)|  486512.41( 84%)|-27
2^(24)| 1222825.73|  983923.26( 80%)| 3862900.57(316%)| 1065831.99( 87%)|-27
------+-----------+-----------------+-----------------+-----------------+---
 cost |  375258.00|  419699.06(112%)|  850003.55(227%)|  291057.25( 78%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　FFTW も OTFFT も AVX を有効にしてコンパイルしたんですけど、
FFTW はイマイチですね。
一方、OTFFT は Stockham のアルゴリズムと AVX の相性がバッチリです。
こんなのは本当の AVX じゃない。一週間後、
俺が本当の AVX をお見せしますよって感じです<code>(^^;</code>
</p>
<p>
　しかし、本当に驚異的なのは、SSE2 や AVX のイントリンシックを使ってないのに、
\(2^{19}\) 以上の系列長で FFTW より速く、
\(2^{23}\) 以上の系列長で OTFFT より速い大浦さんのライブラリです。
惜しむらくは、大浦さんのライブラリはもう開発が止まってるっぽいことですね。
マルチスレッドも 4 並列までしかサポートしないようなので、
最近のコンピュータで使うとなると、どうしても見劣りします。
</p>
<hr>
</body>
</html>
