<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="description" content="OTFFT のシングルスレッドベンチマーク">
<meta name="keywords" content="OTFFT,シングルスレッド,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="node4.html">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript" src="ga.js"></script>

<title>OTFFT のシングルスレッドベンチマーク</title>
</head>
<body>
<h1>OTFFT のシングルスレッドベンチマーク</h1>
<p>
　OTFFT はデフォルトでは OpenMP によるマルチスレッドで動作します。しかし、
中にはマルチスレッドの実装は、自前の仕組みを使いたい人もいるかもしれません。
そこで、シングルスレッドで動作するモードも用意しました。
OTFFT は DO_SINGLE_THREAD マクロを定義してコンパイルすると、
シングルスレッドモードになります。
</p>
<p>
　そんなわけで、シングルスレッドのベンチマークもしてみました。
実行環境は MacBook Pro 15 inch Late 2013(Haswell Core i7 2GHz) 上の
OS X El Capitan/GCC 5.3 です。
比較した FFTW3 はバージョン 3.3.4 の <code>FFTW_MEASURE</code> です。
浮動小数点数の精度は倍精度です。
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.03|       0.02( 64%)|       0.02( 65%)|       0.01( 48%)| -
2^( 2)|       0.03|       0.02( 81%)|       0.04(141%)|       0.02( 51%)| -
2^( 3)|       0.04|       0.06(137%)|       0.07(176%)|       0.03( 62%)|-29
2^( 4)|       0.09|       0.12(136%)|       0.16(192%)|       0.06( 67%)|-27
2^( 5)|       0.15|       0.37(245%)|       0.33(218%)|       0.13( 83%)|-26
2^( 6)|       0.30|       0.79(268%)|       0.77(259%)|       0.23( 78%)|-26
2^( 7)|       0.67|       1.81(272%)|       1.62(244%)|       0.53( 79%)|-25
2^( 8)|       1.37|       3.81(279%)|       3.69(270%)|       1.08( 79%)|-24
2^( 9)|       3.25|       8.63(266%)|       7.92(244%)|       2.44( 75%)|-24
2^(10)|       7.37|      18.41(250%)|      18.13(246%)|       6.54( 89%)|-23
2^(11)|      17.02|      41.18(242%)|      40.51(238%)|      15.74( 92%)|-22
2^(12)|      43.36|      91.64(211%)|     102.70(237%)|      41.89( 97%)|-22
2^(13)|     111.26|     200.62(180%)|     230.18(207%)|      97.77( 88%)|-21
2^(14)|     259.95|     431.50(166%)|     535.53(206%)|     227.84( 88%)|-20
2^(15)|     565.84|     967.66(171%)|    1286.81(227%)|     489.04( 86%)|-20
2^(16)|    1200.30|    1969.98(164%)|    2765.06(230%)|    1232.74(103%)|-19
2^(17)|    2794.76|    4120.37(147%)|    6066.82(217%)|    2589.50( 93%)|-18
2^(18)|    7136.56|    8910.71(125%)|   14727.80(206%)|    6174.29( 87%)|-18
2^(19)|   23660.65|   19041.38( 80%)|   39732.28(168%)|   17381.47( 73%)|-17
2^(20)|   52428.00|   41963.42( 80%)|   97603.68(186%)|   34214.21( 65%)|-16
2^(21)|  117570.44|   86247.11( 73%)|  229867.00(196%)|   65431.56( 56%)|-16
2^(22)|  253779.00|  187774.50( 74%)|  540231.75(213%)|  163714.75( 65%)|-15
2^(23)|  582271.50|  412863.50( 71%)| 1601331.50(275%)|  482412.50( 83%)|-15
2^(24)| 1201822.00|  963359.00( 80%)| 4112857.00(342%)| 1049492.00( 87%)|-14
------+-----------+-----------------+-----------------+-----------------+---
 cost |  377750.42|  417281.29(110%)|  861205.42(228%)|  289524.39( 77%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　FFTW も OTFFT も AVX を有効にしてコンパイルしたんですけど、
FFTW はイマイチですね。
一方、OTFFT は Stockham のアルゴリズムと AVX の相性がバッチリです。
こんなのは本当の AVX じゃない。一週間後、
俺が本当の AVX をお見せしますよって感じです<code>(^^;</code>
</p>
<p>
　しかし、本当に驚異的なのは、SSE2 や AVX のイントリンシックを使ってないのに、
\(2^{19}\) 以上の系列長で FFTW より速く、
\(2^{23}\) 以上の系列長で OTFFT より速い大浦さんのライブラリです。
惜しむらくは、大浦さんのライブラリはもう開発が止まってるっぽいことですね。
マルチスレッドも 4 並列までしかサポートしないようなので、
最近のコンピュータで使うとなると、どうしても見劣りします。
</p>
<hr>
</body>
</html>
