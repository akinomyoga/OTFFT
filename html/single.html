<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="description" content="OTFFT のシングルスレッドベンチマーク">
<meta name="keywords" content="OTFFT,シングルスレッド,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="node4.html">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript" src="ga.js"></script>

<title>OTFFT のシングルスレッドベンチマーク</title>
</head>
<body>
<a href="node4.html">FFTW より速い FFT ライブラリ OTFFT</a>
<hr>

<h1>OTFFT のシングルスレッドベンチマーク</h1>
<p>
　OTFFT はデフォルトでは OpenMP によるマルチスレッドで動作します。しかし、
中にはマルチスレッドの実装は、自前の仕組みを使いたい人もいるかもしれません。
そこで、シングルスレッドで動作するモードも用意しました。
OTFFT は DO_SINGLE_THREAD マクロを定義してコンパイルすると、
シングルスレッドモードになります。
</p>
<p>
　そんなわけで、シングルスレッドのベンチマークもしてみました。
条件は以下のようになります。
</p>
<table style="padding-left:1em">
    <tr>
        <td>Machine:</td><td>MacBook Pro 15 inch Late 2013 (Haswell Core i7 2GHz)</td>
    </tr>
    <tr>
        <td>OS:</td><td>OS X El Capitan</td>
    </tr>
    <tr>
        <td>Compiler:</td><td>Clang 3.9</td>
    </tr>
    <tr>
        <td>cores/threads:</td><td>4 cores/1 thread</td>
    </tr>
    <tr>
        <td>FFTW Version:</td><td>3.3.5</td>
    </tr>
    <tr>
        <td>FFTW Mode:</td><td>FFTW_MEASURE (AVX2 enabled)</td>
    </tr>
    <tr>
        <td>浮動小数点数の精度:</td><td>倍精度</td>
    </tr>
</table>
<p>
ベンチマーク結果は以下のようになります。
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.03|       0.02( 61%)|       0.02( 54%)|       0.01( 31%)| -
2^( 2)|       0.03|       0.02( 70%)|       0.03(103%)|       0.01( 35%)| -
2^( 3)|       0.05|       0.05(113%)|       0.06(134%)|       0.02( 49%)|-28
2^( 4)|       0.08|       0.11(131%)|       0.14(170%)|       0.05( 57%)|-27
2^( 5)|       0.15|       0.35(232%)|       0.27(182%)|       0.11( 74%)|-27
2^( 6)|       0.29|       0.80(274%)|       0.67(228%)|       0.21( 73%)|-26
2^( 7)|       0.60|       1.82(306%)|       1.37(230%)|       0.52( 88%)|-25
2^( 8)|       1.23|       4.38(355%)|       3.27(265%)|       1.12( 91%)|-25
2^( 9)|       3.07|       9.02(294%)|       6.85(223%)|       2.55( 83%)|-24
2^(10)|       7.45|      20.02(269%)|      15.95(214%)|       6.60( 89%)|-22
2^(11)|      17.36|      44.79(258%)|      35.18(203%)|      15.46( 89%)|-22
2^(12)|      49.07|     100.22(204%)|      96.28(196%)|      45.39( 92%)|-22
2^(13)|     108.84|     221.65(204%)|     217.02(199%)|     100.33( 92%)|-21
2^(14)|     261.97|     475.67(182%)|     501.34(191%)|     231.03( 88%)|-20
2^(15)|     566.57|    1055.42(186%)|    1213.14(214%)|     505.46( 89%)|-19
2^(16)|    1227.13|    2259.72(184%)|    2718.39(222%)|    1247.99(102%)|-19
2^(17)|    2870.26|    4463.65(156%)|    5927.26(207%)|    2706.74( 94%)|-18
2^(18)|    6858.93|   10769.50(157%)|   13592.80(198%)|    6312.14( 92%)|-18
2^(19)|   23232.44|   22286.98( 96%)|   38805.69(167%)|   15932.69( 69%)|-17
2^(20)|   47349.47|   50978.10(108%)|   96383.92(204%)|   32182.71( 68%)|-16
2^(21)|  129152.30|   96490.15( 75%)|  239259.00(185%)|   66334.24( 51%)|-16
2^(22)|  280796.95|  221983.07( 79%)|  557601.19(199%)|  188107.98( 67%)|-15
2^(23)|  624020.42|  466706.57( 75%)| 1640427.10(263%)|  491595.83( 79%)|-15
2^(24)| 1249313.25| 1102021.69( 88%)| 4296091.87(344%)| 1099916.47( 88%)|-14
------+-----------+-----------------+-----------------+-----------------+---
 cost |  388297.63|  466021.24(120%)|  852095.71(219%)|  292417.90( 75%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　FFTW も OTFFT も AVX を有効にしてコンパイルしたんですけど、
FFTW はイマイチですね。
一方、OTFFT は Stockham のアルゴリズムと AVX の相性がバッチリです。
こんなのは本当の AVX じゃない。一週間後、
俺が本当の AVX をお見せしますよって感じです<code>(^^;</code>
</p>
<p>
　しかし、本当に驚異的なのは、SSE2 や AVX のイントリンシックを使ってないのに、
大きな系列長で OTFFT と同等の速度の大浦さんのライブラリです。
惜しむらくは、大浦さんのライブラリはもう開発が止まってるっぽいことですね。
マルチスレッドも 4 並列までしかサポートしないようなので、
最近のコンピュータで使うとなると、どうしても見劣りします。
</p>

<hr>
<a href="node4.html">FFTW より速い FFT ライブラリ OTFFT</a>
</body>
</html>
