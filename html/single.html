<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="description" content="OTFFT のシングルスレッドベンチマーク">
<meta name="keywords" content="OTFFT,シングルスレッド,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="node4.html">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript" src="ga.js"></script>

<title>OTFFT のシングルスレッドベンチマーク</title>
</head>
<body>
<a href="node4.html">FFTW より速い FFT ライブラリ OTFFT</a>
<hr>

<h1>OTFFT のシングルスレッドベンチマーク</h1>
<p>
　OTFFT はデフォルトでは OpenMP によるマルチスレッドで動作します。しかし、
中にはマルチスレッドの実装は、自前の仕組みを使いたい人もいるかもしれません。
そこで、シングルスレッドで動作するモードも用意しました。
OTFFT は DO_SINGLE_THREAD マクロを定義してコンパイルすると、
シングルスレッドモードになります。
</p>
<p>
　そんなわけで、シングルスレッドのベンチマークもしてみました。
条件は以下のようになります。
<!--
実行環境は MacBook Pro 15 inch Late 2013(Haswell Core i7 2GHz) 上の
OS X El Capitan/GCC 5.3 です。
比較した FFTW3 はバージョン 3.3.4 の <code>FFTW_MEASURE</code> です。
浮動小数点数の精度は倍精度です。
-->
</p>
<table style="padding-left:1em">
    <tr>
        <td>Machine:</td><td>MacBook Pro 15 inch Late 2013(Haswell Core i7 2GHz)</td>
    </tr>
    <tr>
        <td>OS:</td><td>OS X El Capitan</td>
    </tr>
    <tr>
        <td>Compiler:</td><td>GCC 5.3</td>
    </tr>
    <tr>
        <td>cores/threads:</td><td>4 cores/1 thread</td>
    </tr>
    <tr>
        <td>FFTW Version:</td><td>3.3.4</td>
    </tr>
    <tr>
        <td>FFTW Mode:</td><td>FFTW_MEASURE (AVX enabled)</td>
    </tr>
    <tr>
        <td>浮動小数点数の精度:</td><td>倍精度</td>
    </tr>
</table>
<p>
ベンチマーク結果は以下のようになります。
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.03|       0.02( 65%)|       0.02( 66%)|       0.02( 57%)| -
2^( 2)|       0.03|       0.02( 81%)|       0.04(142%)|       0.02( 60%)| -
2^( 3)|       0.05|       0.06(133%)|       0.07(163%)|       0.03( 68%)|-29
2^( 4)|       0.08|       0.12(146%)|       0.16(203%)|       0.05( 68%)|-27
2^( 5)|       0.16|       0.37(237%)|       0.33(212%)|       0.13( 83%)|-26
2^( 6)|       0.29|       0.80(274%)|       0.76(260%)|       0.21( 73%)|-26
2^( 7)|       0.67|       1.84(277%)|       1.61(242%)|       0.57( 85%)|-25
2^( 8)|       1.45|       3.86(265%)|       3.71(255%)|       1.22( 84%)|-24
2^( 9)|       3.11|       8.66(278%)|       7.98(257%)|       2.67( 86%)|-24
2^(10)|       7.29|      18.52(254%)|      18.08(248%)|       6.64( 91%)|-23
2^(11)|      17.70|      41.26(233%)|      40.63(230%)|      17.50( 99%)|-22
2^(12)|      47.98|      90.92(190%)|     103.59(216%)|      43.33( 90%)|-22
2^(13)|     110.14|     202.55(184%)|     231.43(210%)|     106.86( 97%)|-21
2^(14)|     272.56|     429.14(157%)|     534.55(196%)|     235.86( 87%)|-20
2^(15)|     561.45|     968.45(172%)|    1260.89(225%)|     501.15( 89%)|-20
2^(16)|    1219.20|    1967.45(161%)|    2732.03(224%)|    1233.72(101%)|-19
2^(17)|    2866.48|    4106.58(143%)|    6180.79(216%)|    2666.95( 93%)|-18
2^(18)|    6945.19|    8934.79(129%)|   15041.76(217%)|    6119.74( 88%)|-18
2^(19)|   24534.12|   19290.05( 79%)|   39902.35(163%)|   15785.73( 64%)|-17
2^(20)|   52458.74|   41868.53( 80%)|   99244.16(189%)|   31810.42( 61%)|-16
2^(21)|  114497.44|   86666.56( 76%)|  233054.89(204%)|   69921.44( 61%)|-16
2^(22)|  261429.50|  186273.50( 71%)|  541005.00(207%)|  166318.50( 64%)|-15
2^(23)|  586501.00|  418940.00( 71%)| 1583356.50(270%)|  477874.50( 81%)|-15
2^(24)| 1283982.00|  968277.00( 75%)| 4003086.00(312%)| 1078067.00( 84%)|-14
------+-----------+-----------------+-----------------+-----------------+---
 cost |  384336.62|  418856.67(109%)|  858505.00(223%)|  293409.18( 76%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　FFTW も OTFFT も AVX を有効にしてコンパイルしたんですけど、
FFTW はイマイチですね。
一方、OTFFT は Stockham のアルゴリズムと AVX の相性がバッチリです。
こんなのは本当の AVX じゃない。一週間後、
俺が本当の AVX をお見せしますよって感じです<code>(^^;</code>
</p>
<p>
　しかし、本当に驚異的なのは、SSE2 や AVX のイントリンシックを使ってないのに、
\(2^{19}\) 以上の系列長で FFTW より速く、
\(2^{23}\) 以上の系列長で OTFFT より速い大浦さんのライブラリです。
惜しむらくは、大浦さんのライブラリはもう開発が止まってるっぽいことですね。
マルチスレッドも 4 並列までしかサポートしないようなので、
最近のコンピュータで使うとなると、どうしても見劣りします。
</p>

<hr>
<a href="node4.html">FFTW より速い FFT ライブラリ OTFFT</a>
</body>
</html>
