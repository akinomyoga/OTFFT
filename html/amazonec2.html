<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="description" content="Amazon EC2 による 32 並列のベンチマーク">
<meta name="keywords" content="OTFFT,Amazon EC2,ベンチマーク">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="stockham.css" TYPE="text/css">
<link rel="up" href="node4.html">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript" src="ga.js"></script>

<title>Amazon EC2 による 32 並列のベンチマーク</title>
</head>
<body>
<h1>Amazon EC2 による 32 並列のベンチマーク</h1>
<p>
　OTFFT の性能を測るのに、今までずっと自分の MacBook Pro を使ってきました。
しかし、私の MacBook Pro は 4 コア 8 スレッド(HT)です。
数値計算とかやってる人は、もっとゴージャスな環境で計算するんじゃね？
と思って、清水の舞台から飛び降りる覚悟で Amazon EC2 でベンチマークしてみました。
</p>
<p>
　それにしても、利用時間に応じて課金される環境というのはドキドキですね。
大学とかでスーパーコンピュータとか使ってる人もこんな気分なんでしょうか。
え？自分のコンピュータだって電気代がかかるって？いやまあ、
そうなんですけどね<code>(^^;</code>
</p>
<p>
それでは、ベンチマーク結果を示しましょう。
実行環境は Amazon EC2 c4.8xlarge(Intel Xeon E5-2666 v3 (Haswell)) 上の
Ubuntu 14.04/GCC 4.8 です。
比較した FFTW3 はバージョン 3.3.4 の <code>FFTW_MEASURE</code> です。
浮動小数点数の精度は倍精度です。
並列度はいろいろ試したんですが、
最大 36 並列の中では 32 並列あたりが、
安定して良い結果が出ましたので、まずは 32 並列の結果を示します。
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.02|       0.02( 70%)|       0.02( 82%)|       0.01( 35%)| -
2^( 2)|       0.03|       0.02( 79%)|       0.05(183%)|       0.01( 41%)| -
2^( 3)|       0.04|       0.05(113%)|       0.08(185%)|       0.02( 47%)|-29
2^( 4)|       0.09|       0.10(112%)|       0.18(196%)|       0.04( 46%)|-28
2^( 5)|       0.14|       0.31(224%)|       0.35(253%)|       0.10( 73%)|-28
2^( 6)|       0.26|       0.68(267%)|       0.81(316%)|       0.18( 71%)|-28
2^( 7)|       0.55|       1.50(274%)|       1.64(298%)|       0.47( 85%)|-28
2^( 8)|       1.12|       3.29(294%)|       3.79(338%)|       0.94( 84%)|-28
2^( 9)|       2.69|       7.31(272%)|       7.91(294%)|       2.10( 78%)|-28
2^(10)|       6.09|      15.85(260%)|      18.21(299%)|       5.65( 93%)|-28
2^(11)|      15.24|      35.21(231%)|      38.84(255%)|      13.92( 91%)|-27
2^(12)|      40.52|      76.88(190%)|      96.44(238%)|      38.75( 96%)|-27
2^(13)|      97.03|     383.46(395%)|     220.80(228%)|      70.21( 72%)|-27
2^(14)|     395.64|     668.87(169%)|     532.78(135%)|      96.83( 24%)|-27
2^(15)|     401.27|    1665.28(415%)|     553.25(138%)|     160.93( 40%)|-27
2^(16)|    1195.71|    2607.98(218%)|     978.62( 82%)|     202.72( 17%)|-27
2^(17)|    1825.38|    4766.78(261%)|    2069.56(113%)|     550.33( 30%)|-27
2^(18)|    3021.90|   10261.63(340%)|    3934.94(130%)|     943.33( 31%)|-27
2^(19)|    5964.62|   18323.17(307%)|    8273.79(139%)|    2039.93( 34%)|-27
2^(20)|   12734.18|   40932.36(321%)|   17466.76(137%)|    4174.01( 33%)|-27
2^(21)|   30813.03|   80632.83(262%)|   47604.28(154%)|   20847.35( 68%)|-27
2^(22)|   59331.19|  124306.56(210%)|  160214.44(270%)|   54930.62( 93%)|-27
2^(23)|  126799.89|  272212.79(215%)|  269220.65(212%)|   77767.71( 61%)|-27
2^(24)|  247807.03|  550754.04(222%)|  602803.00(243%)|  201580.21( 81%)|-27
------+-----------+-----------------+-----------------+-----------------+---
 cost |  172309.56|  413929.55(240%)|  313170.43(182%)|   92209.35( 54%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
<p>
　length の欄は FFT の系列長を表しています。
そして、言うまでもなく FFTW3 の欄が FFTW3 での実行時間です。
DFT と IDFT の実行時間の和を表示しています。
OOURA の欄は大浦さんの FFT ライブラリ fftsg.c での実行時間です。
SimpleFFT の欄はごく単純な4基底の Cooley-Tukey アルゴリズムの実行時間です。
そして OTFFT の欄が私 OK おじさんが提案する FFT ライブラリでの実行時間です。
実行時間の単位はマイクロ秒で、
初期化の時間(FFTW3 のプランの作成等)は含まれていません。
括弧の中の％付きの数字は
FFTW3 の実行時間に対して何パーセントの実行時間になるかを表しています。
err の欄は FFTW3 と OTFFT の２乗誤差の対数です。
エラーチェックのために付けてあります。開発者用なので気にしないでください。
cost は全てのサイズで平均した速さの目安です。小さいほど高速です。
</p>
<p>
　ご覧のように、OTFFT でサポートされる全ての系列長である
\(2^1\) 〜 \(2^{24}\) において、OTFFT が FFTW より速くなっております。
ちなみに、HT ではない本当の 8 並列でのベンチマークは以下のようになります。
残念ながら、\(2^{12}\) で FFTW より遅いですが、それ以外は OTFFT の方が高速です。
OTFFT は構造が単純なので、
並列度が上がると性能が向上するという私の仮説はどうやら正しいようです。
みなさ〜ん、メニーコアで FFT するなら OTFFT ですよー(^_^)
</p>
<pre>
------+-----------+-----------------+-----------------+-----------------+---
length|FFTW3[usec]|   OOURA   [usec]| SimpleFFT [usec]|   OTFFT   [usec]|err
------+-----------+-----------------+-----------------+-----------------+---
2^( 1)|       0.02|       0.02( 70%)|       0.02( 82%)|       0.01( 37%)| -
2^( 2)|       0.03|       0.02( 84%)|       0.05(195%)|       0.01( 44%)| -
2^( 3)|       0.04|       0.05(135%)|       0.08(219%)|       0.02( 55%)|-29
2^( 4)|       0.07|       0.10(150%)|       0.18(262%)|       0.04( 62%)|-28
2^( 5)|       0.13|       0.31(232%)|       0.35(259%)|       0.10( 77%)|-27
2^( 6)|       0.27|       0.68(252%)|       0.80(297%)|       0.18( 67%)|-28
2^( 7)|       0.53|       1.50(282%)|       1.64(308%)|       0.43( 81%)|-28
2^( 8)|       1.15|       3.28(286%)|       3.82(333%)|       0.94( 82%)|-28
2^( 9)|       2.76|       7.39(268%)|       7.95(288%)|       2.12( 77%)|-28
2^(10)|       6.02|      15.90(264%)|      18.26(303%)|       5.70( 95%)|-28
2^(11)|      14.67|      35.01(239%)|      39.05(266%)|      14.04( 96%)|-27
2^(12)|      39.79|      77.10(194%)|      96.63(243%)|      41.74(105%)|-27
2^(13)|      94.57|     385.14(407%)|     222.04(235%)|      88.28( 93%)|-27
2^(14)|     351.73|     665.56(189%)|     535.67(152%)|      90.80( 26%)|-27
2^(15)|     448.68|    1666.13(371%)|     935.80(209%)|     166.68( 37%)|-27
2^(16)|     696.12|    2610.38(375%)|    2018.36(290%)|     282.25( 41%)|-27
2^(17)|    1937.93|    4807.96(248%)|    3381.75(175%)|     683.74( 35%)|-27
2^(18)|    3680.82|   10363.60(282%)|    7980.93(217%)|    1479.83( 40%)|-27
2^(19)|    7312.02|   18246.90(250%)|   12184.41(167%)|    3183.56( 44%)|-27
2^(20)|   17933.45|   41805.77(233%)|   28515.10(159%)|    6764.82( 38%)|-27
2^(21)|   42374.46|   82345.00(194%)|   71903.28(170%)|   20412.03( 48%)|-27
2^(22)|   77247.88|  132798.12(172%)|  180239.13(233%)|   46208.84( 60%)|-27
2^(23)|  153538.26|  252282.56(164%)|  439334.84(286%)|  107832.02( 70%)|-27
2^(24)|  290474.38|  530579.04(183%)| 1022925.54(352%)|  236839.11( 82%)|-27
------+-----------+-----------------+-----------------+-----------------+---
 cost |  181805.34|  414487.67(228%)|  405155.97(223%)|  102811.56( 57%)|
------+-----------+-----------------+-----------------+-----------------+---
</pre>
</body>
</html>
